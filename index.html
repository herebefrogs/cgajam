<html><head><style>body {
    margin: 0;
    text-align: center;
    background-color: #000;
  }</style></head><body><canvas></canvas><script>"use strict";var _slicedToArray=function(){function e(e,t){var o=[],i=!0,a=!1,n=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){a=!0,n=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw n}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,o){(o||navigator.getGamepads())[e.gamepad.index]&&e.gamepad.connected?(console.log("[gamepad] connecting",e.gamepad),_=e.gamepad):t({gamepad:{index:e.gamepad.index,connected:!1}})}function t(e){_&&_.index===e.gamepad.index&&!e.gamepad.connected&&(console.log("[gamepad] disconnecting",_),_=void 0)}function o(){var t=navigator.getGamepads();if(!_){var o=!0,i=!1,a=void 0;try{for(var n,r=t[Symbol.iterator]();!(o=(n=r.next()).done);o=!0){var l=n.value;if(l&&l.connected){e({gamepad:l},t);break}}}catch(e){i=!0,a=e}finally{try{!o&&r.return&&r.return()}finally{if(i)throw a}}}if(_)return{leftX:Math.round(100*_.axes[S])/100,leftY:Math.round(100*_.axes[I])/100,buttonA:_.buttons[D].pressed,buttonB:_.buttons[L].pressed,buttonX:_.buttons[B].pressed,buttonY:_.buttons[U].pressed}}function i(){W.drawImage(O,0,0,O.width,O.height,0,0,Q.width,Q.height)}function a(e){e.target.hidden&&_&&t({gamepad:{index:_.index,connected:!1}}),E(!event.target.hidden)}function n(e,t,o){return{frame:0,nextFrame:0,type:e,x:t,y:o}}function r(e,t,o,i){return{collide:e.indexOf("door")===-1,item:i,state:"initial",type:e,x:t*P,y:o*P}}function l(){return{bounds:C.hero.bounds,moveDown:0,moveLeft:0,moveRight:0,moveUp:0,items:{now:{key:1,sword:0},max:{key:1,sword:0}},speed:C.hero.speed,state:"initial",type:"hero",x:G.x,y:G.y}}function s(){A("you won!",(Z.x+P)/2-4*Y,Z.y+Y/2),i(),E(!1)}function d(){addEventListener("resize",x),O.width=F,O.height=R,j.width=F,j.height=R,x(),w(re).then(function(e){re=e}).then(function(){return w(J)}).then(function(e){J=e}).then(v)}function c(e){switch(e.which){case 37:case 65:case 81:V.moveLeft=-1,V.moveUp=V.moveDown=0;break;case 38:case 90:case 87:V.moveUp=-1,V.moveLeft=V.moveRight=0;break;case 39:case 68:V.moveRight=1,V.moveUp=V.moveDown=0;break;case 40:case 83:V.moveDown=1,V.moveLeft=V.moveRight=0;break;case 80:E(!ne)}}function m(e){switch(e.which){case 37:case 65:case 81:V.moveLeft=0;break;case 38:case 90:case 87:V.moveUp=0;break;case 39:case 68:V.moveRight=0;break;case 40:case 83:V.moveDown=0}}function v(){addEventListener("keydown",c),addEventListener("keyup",m),addEventListener("gamepadconnected",e),addEventListener("gamepaddisconnected",t),document.addEventListener("visibilitychange",a),K=[],N=[],h(M),E(!0)}function h(e){X.fillStyle="#000",X.fillRect(0,0,j.width,j.height);var t=void 0,o=void 0;for(o=0;o<e.length;o++)for(t=0;t<e[o].length;t++){var i=e[o][t].split("."),a=_slicedToArray(i,2),n=a[0],s=a[1];if("tile"!==n){var d=r(n,t,o,s);"door_north"===n?G=d:"door_south"===n?ae=d:"door_east"===n&&(Z=d),K.push(d)}var c=C[n].sprites.initial;X.drawImage(re,c.x,c.y,P,P,t*P,o*P,P,P)}V=l(),K.push(V),$=o*P+Y/2;var m=6*Y;ee=m+P,te=ee+2*P,A("items",0,$,X);var v=C.key.sprites[0];X.drawImage(re,v.x,v.y,P,P,m,$-Y/2,P,P),v=C.sword.sprites[0],X.drawImage(re,v.x,v.y,P,P,te-P,$-Y/2,P,P)}function w(e){return new Promise(function(t){var o=new Image;o.addEventListener("load",function(){t(o)}),o.src=e})}function y(){ne&&(ie=requestAnimationFrame(y),u(),T=Date.now(),k((T-oe)/1e3),oe=T)}function u(){z.drawImage(j,0,0);var e=!0,t=!1,o=void 0;try{for(var a,n=K[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){f(a.value)}}catch(e){t=!0,o=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw o}}var r=!0,l=!1,s=void 0;try{for(var d,c=N[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){g(d.value)}}catch(e){l=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw s}}A("x"+V.items.now.key,ee,$),A("x"+V.items.now.sword,te,$),i()}function g(e){var t=C[e.type].sprites[e.frame];z.drawImage(re,t.x,t.y,P,P,Math.round(e.x),Math.round(e.y),P,P)}function f(e){var t=C[e.type].sprites[e.state];z.drawImage(re,t.x,t.y,P,P,Math.round(e.x),Math.round(e.y),P,P)}function A(e,t,o){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z,a=0;a<e.length;a++)i.drawImage(J,H.indexOf(e[a])*Y,0,Y,Y,t+a*Y,o,Y,Y)}function b(){V.y=G.y,V.items.now.key=V.items.max.key,V.items.now.sword=V.items.max.sword;var e=!0,t=!1,o=void 0;try{for(var i,a=K[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var n=i.value;"chest"!==n.type&&"crate"!==n.type||(n.state="initial",n.collide=!0)}}catch(e){t=!0,o=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw o}}}function x(){var e=Math.min(innerWidth/F,innerHeight/R);Q.width=F*e,Q.height=R*e,X.mozImageSmoothingEnabled=z.mozImageSmoothingEnabled=W.mozImageSmoothingEnabled=!1,X.mozImageSmoothingEnabled=z.msImageSmoothingEnabled=W.msImageSmoothingEnabled=!1,X.mozImageSmoothingEnabled=z.imageSmoothingEnabled=W.imageSmoothingEnabled=!1}function p(e,t){var o=e.speed*t;e.x+=o*(e.moveLeft+e.moveRight),e.y+=o*(e.moveUp+e.moveDown)}function E(e){ne=e,ne?(oe=Date.now(),y()):cancelAnimationFrame(ie)}function k(e){var t=o();t&&(t.leftX<=0?(V.moveLeft=t.leftX,V.moveRight=0):(V.moveLeft=0,V.moveRight=t.leftX),t.leftY<=0?(V.moveUp=t.leftY,V.moveDown=0):(V.moveUp=0,V.moveDown=t.leftY)),p(V,e);var i=!0,a=!1,r=void 0;try{for(var l,d=K[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var c=l.value;c!==V&&(c!==G?c!==ae?c!==Z?c.collide&&V.x+V.bounds.x<c.x+P&&V.x+V.bounds.w>c.x&&V.y+V.bounds.y<c.y+P&&V.y+V.bounds.h>c.y&&(V.moveRight&&(V.x-=V.x+V.bounds.w-c.x),V.moveLeft&&(V.x+=c.x+P-V.x-V.bounds.x),V.moveDown&&(V.y-=V.y+V.bounds.h-c.y),V.moveUp&&(V.y+=c.y+P-V.y-V.bounds.y),"chest"===c.type&&"initial"===c.state&&V.items.now.key?(c.state="altered",V.items.now.key--,c.item&&(V.items.now[c.item]++,V.items.max[c.item]++,N.push(n(c.item,c.x,c.y-P)),c.item=void 0)):"crate"===c.type&&"initial"===c.state&&V.items.now.sword&&(c.state="altered",c.collide=!1,V.items.now.sword--)):V.x+V.bounds.w>Z.x+P&&s():V.y+V.bounds.h>ae.y+P&&b():V.y+V.bounds.y<G.y&&(V.y=G.y-V.bounds.y))}}catch(e){a=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(a)throw r}}var m=!0,v=!1,h=void 0;try{for(var w,y=N.entries()[Symbol.iterator]();!(m=(w=y.next()).done);m=!0){var u=_slicedToArray(w.value,2),g=u[0],f=u[1];f.nextFrame+=e,f.nextFrame>q&&(f.nextFrame-=q,++f.frame>=C[f.type].sprites.length&&N.splice(g,1))}}catch(e){v=!0,h=e}finally{try{!m&&y.return&&y.return()}finally{if(v)throw h}}}var S=0,I=1,D=0,L=1,B=2,U=3,_=void 0;navigator.getGamepads||(o=function(){}),document.title="CGA Jam";var R=160,F=176,P=16,Y=8,C={block:{sprites:{initial:{x:48,y:16}}},chest:{sprites:{initial:{x:80,y:0},altered:{x:96,y:0}}},crate:{sprites:{initial:{x:48,y:0},altered:{x:64,y:0}}},door_east:{sprites:{initial:{x:32,y:16}}},door_north:{sprites:{initial:{x:0,y:16}}},door_south:{sprites:{initial:{x:16,y:16}}},sword:{sprites:[{x:32,y:0}]},hero:{speed:30,bounds:{x:2,y:1,w:13,h:15},sprites:{initial:{x:0,y:0}}},key:{sprites:[{x:16,y:0}]},tile:{sprites:{initial:{x:64,y:16}}},wall_h:{sprites:{initial:{x:80,y:16}}},wall_v:{sprites:{initial:{x:96,y:16}}}},M=[["wall_h","wall_h","door_north","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"],["wall_v","block","tile","block","chest.sword","tile","crate","tile","tile","chest.sword","wall_v"],["wall_v","tile","tile","block","block","tile","tile","block","tile","tile","wall_v"],["wall_v","tile","tile","tile","crate","tile","crate","chest.key","block","crate","wall_v"],["wall_v","chest.sword","tile","tile","block","block","tile","tile","crate","crate","door_east"],["wall_v","tile","tile","block","block","block","crate","tile","block","crate","wall_v"],["wall_v","tile","tile","tile","crate","tile","tile","crate","tile","tile","wall_v"],["wall_v","block","tile","tile","tile","block","block","chest.key","block","chest.sword","wall_v"],["wall_h","wall_h","door_south","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"]],H="abcdefghijklmnopqrstuvwxyz0123456789.:!-%",Q=document.querySelector("canvas"),W=Q.getContext("2d"),O=document.createElement("canvas"),z=O.getContext("2d"),j=document.createElement("canvas"),X=j.getContext("2d"),q=.4,J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUgAAAAICAYAAACbO2brAAAB5klEQVR42uVa2YrDMAw07Fvf9v8/tqWwhTZY18zI9tJAWlLHiqJjPHI1fm8/d/Qcf4c3js6t6JAdUz0T1eeqR1WX2RxLTsY3nh7s/BPP7DspZGbsw+iS0bUSi6gt0Pcf4oOR7+bX88M6Xjd1jL87cNXzo2vF8yP5M4DMzp9dWzaM7HsNCPX8Dv/svq7YSGXfyng2NqJ7Mr5Vvb8SIBHZr3mWPUc1gLsB5P33bwRIhf3+6/gOgNs1v0IQojzxYgPJrysDVfqPAUmPHXoAmWHY5kLR4WDPAYoEt+RbhsisgDM5MwMrAJQByJMZWHeCIfMzMVqNj4h9VfMnC4CI/hkZWYC24r9iX5bpWfMigIwYrJmnqxlEJ4NEACwCSFS+l0AewF+/T2VAEYBUFjJFfFl2VJSAlg8rDBBlcSiAov7PgoiVH0j8ZBgiM474F2IwihK1k0Eie3irtxgY+yifn9njUpSI0QrP7nGx9mf1W72FU8kDRfwp7OPlsYIhsiW2t+iPXQ5mAvyEAGZLLBQgmT9pvH/Su/bY0BKoAyAt+50M4Ih9WYas8F9Fv26ArJbuHxUI0+aws82nugnLtHFU2xtWtqlU2zSybRJM6wjS5sG0kTD+725z6Y6FqI1I1YbTPd5ZYmfbg2ZyHuewlwnHUW0vAAAAAElFTkSuQmCC",T=void 0,G=void 0,Z=void 0,K=void 0,N=void 0,V=void 0,$=void 0,ee=void 0,te=void 0,oe=void 0,ie=void 0,ae=void 0,ne=void 0,re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAABQCAYAAADBTPF9AAAEmklEQVR42u2dia7lIAhA+5P+/6cwmWQWnwKyubWQ3GRe72BbjiDSen2ey6UAwM4PDL6b/T1lF0A+2wUa+QvQav3fTXr1vQC48xfB97idiIvdDe+HYcoZAL0AogEOL/gEeKUC+McTzZ8I/VkhUhK+O3godZBBxELcDHiF8MC6A9bHqX+3HoQBam3B6Vs9zNp5Wg/EwVXdpDoZa+jWyLPgSQBqAAy97XSAKLgGIgawNe6Pi2fEC28EsDUeBkwDcKR/BkD4n11hf3MAa+OOYnsLooYqhScNofV3bwbYD2Ol8xg2fHoBdsAE4RgDSMGTAiwgGxP//u39RALEchEWHpriA9772nGpa6fgk2NuLB15RHtsBFCT1EQBdMLvbNj1iuYYDrHwXoaBRHuOALQkhFIeOQKG6XMAOcht8kMlRlb9LorVoGpP0EBsDMD+Hy4RkmaxFADJlIID2P5bMwZSx9oOQo2RGv3OAWobQxOnR6HUO12gjC3NVrW1y9FEXKJPGZsa66QApfpoDXTQC+dWWpCwK/XAU0pp3DxSAlCjf0wxWwLrFoDSz2iaIdG//WnS403DI/S3ZqGjagnwhRn4un7UQ8UCAo/EsnxXNbw4q+mB+mbjB5yfKnzgJ8WPse3CywFqIRage7X2/Jr74WBZj5EAqXAjvWCvvsUDiiXsJcD5AEEawqTQTwPoGBevAQiHAgx7M8o4Lh4FUJM5HgNQm7QQafArQqg6/T8EoOv7BPhSgNZ5oCWERenfGkJneaB5HigxHneBXv0vJjE5jTghiQmuxLgAil5MHYUIp75pIi+o4H9iHnhlKU3xGOa0Skz4PPC6YrbhWdorSmm7H0jerr89iUlJSUlJSUnBF5rsbCOqLe+6RYue55pd9wsBWU47g5/xzqhF39KO5fyea3bdr7SuqerxSmNJ6qei1TjEIhttOxb4ENBZTPaHwVOGVTfATZApw0uXslnaGZ1/xv2DcFleAnwjwEKsFFoNcLRkbbQ4BlvqXYQAqYUmy0OoIPST6/z+/ZRHWQ+wPveoLaweit2Pph3OHlOTmEIv9BG3h67fK7qs0pKBkmsHB21p1iRK2om8l8iFPhFZfUpKSkpKSkrKPWKpbYKxDmipoQLIsszVNdyojNF9XbBhImupoUYU4SNeV4Dg1x7CCtynVuMB5D/NtcL4kQDdbd0EMALiqwCuDoVvgXhMKL4JYCTEVwDcaYCZEKWZnPf+vdnsNu87YRzhIFozac00xZtNu7JqOCQRoIxo0dU+kO6y27JhGmWFV5hnazsAejoUAL7BhqczSwHCwvORDRRjHI8aA6j1AZbOZPEiIFbTzgYYAtHyJHraGOjoSNg7LdrfIYUN82CT/SNDaERNMSKE1h5jKQlazh81/XJ53ylF4SlFZpg7JLhDaL468SFxrXE/4PsECI4VrAEAZuyf9ykpDgAr9sdLgAs8cKd+euBmD4reeiYBbgD4BG/+lAAXelACnJjErACQAAMAPps3zkiAmz3wpP3zPjmTeBz73x2gnx64c/+7yP3zEuCG/e+i989LgIv3v5u1f17OAy/5uccEmFno1fILjM8aJIZzqx4AAAAASUVORK5CYII=";addEventListener("load",d)}();
//# sourceMappingURL=game.js.map</script></body></html>