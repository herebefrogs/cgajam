<html><head><style>body {
    margin: 0;
    text-align: center;
    background-color: #000;
  }</style></head><body><canvas></canvas><script>"use strict";var _slicedToArray=function(){function e(e,t){var o=[],i=!0,n=!1,a=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){n=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,o){(o||navigator.getGamepads())[e.gamepad.index]&&e.gamepad.connected?(console.log("[gamepad] connecting",e.gamepad),P=e.gamepad):t({gamepad:{index:e.gamepad.index,connected:!1}})}function t(e){P&&P.index===e.gamepad.index&&!e.gamepad.connected&&(console.log("[gamepad] disconnecting",P),P=void 0)}function o(){var t=navigator.getGamepads();if(!P){var o=!0,i=!1,n=void 0;try{for(var a,r=t[Symbol.iterator]();!(o=(a=r.next()).done);o=!0){var l=a.value;if(l&&l.connected){e({gamepad:l},t);break}}}catch(e){i=!0,n=e}finally{try{!o&&r.return&&r.return()}finally{if(i)throw n}}}if(P)return{leftX:Math.round(100*P.axes[D])/100,leftY:Math.round(100*P.axes[B])/100,buttonA:P.buttons[U].pressed,buttonB:P.buttons[R].pressed,buttonX:P.buttons[_].pressed,buttonY:P.buttons[F].pressed}}function i(){X.drawImage(q,0,0,q.width,q.height,0,0,O.width,O.height)}function n(e){e.target.hidden&&P&&t({gamepad:{index:P.index,connected:!1}}),I(!event.target.hidden)}function a(e,t,o){return{frame:0,nextFrame:0,type:e,x:t,y:o}}function r(e,t,o,i){return{collide:e.indexOf("door")===-1,item:i,state:"initial",type:e,x:t*H,y:o*H}}function l(){return{bounds:j.hero.bounds,moveDown:0,moveLeft:0,moveRight:0,moveUp:0,items:{now:{key:1,sword:0},max:{key:1,sword:0}},speed:j.hero.speed,state:"initial",type:"hero",x:V.x,y:V.y}}function s(){p("you won!",($.x+H)/2-4*Q,$.y+Q/2),i(),I(!1)}function d(){addEventListener("resize",k),q.width=M,q.height=C,J.width=M,J.height=C,k(),y(se).then(function(e){se=e}).then(function(){return y(K)}).then(function(e){K=e}).then(v)}function c(e){switch(e.which){case 37:case 65:case 81:oe.moveLeft=-1,oe.moveUp=oe.moveDown=0;break;case 38:case 90:case 87:oe.moveUp=-1,oe.moveLeft=oe.moveRight=0;break;case 39:case 68:oe.moveRight=1,oe.moveUp=oe.moveDown=0;break;case 40:case 83:oe.moveDown=1,oe.moveLeft=oe.moveRight=0;break;case 80:I(!le)}}function m(e){switch(e.which){case 37:case 65:case 81:oe.moveLeft=0;break;case 38:case 90:case 87:oe.moveUp=0;break;case 39:case 68:oe.moveRight=0;break;case 40:case 83:oe.moveDown=0}}function v(){addEventListener("keydown",f),addEventListener("resize",x),x()}function h(){removeEventListener("keydown",f),removeEventListener("resize",x),addEventListener("keydown",c),addEventListener("keyup",m),addEventListener("gamepadconnected",e),addEventListener("gamepaddisconnected",t),document.addEventListener("visibilitychange",n),ee=[],te=[],w(z),I(!0)}function w(e){G.fillStyle=Y,G.fillRect(0,0,J.width,J.height);var t=void 0,o=void 0;for(o=0;o<e.length;o++)for(t=0;t<e[o].length;t++){var i=e[o][t].split("."),n=_slicedToArray(i,2),a=n[0],s=n[1];if("tile"!==a){var d=r(a,t,o,s);"door_north"===a?V=d:"door_south"===a?re=d:"door_east"===a&&($=d),ee.push(d)}var c=j[a].sprites.initial;G.drawImage(se,c.x,c.y,H,H,t*H,o*H,H,H)}oe=l(),ee.push(oe),ie=o*H+Q/2,p("items",0,ie,G);var m=j.key.sprites[0];G.drawImage(se,m.x,m.y,H,H,M-5*H,ie-Q/2,H,H),m=j.sword.sprites[0],G.drawImage(se,m.x,m.y,H,H,M-2*H,ie-Q/2,H,H)}function y(e){return new Promise(function(t){var o=new Image;o.addEventListener("load",function(){t(o)}),o.src=e})}function u(){le&&(ae=requestAnimationFrame(u),g(),N=Date.now(),L((N-ne)/1e3),ne=N)}function f(e){switch(e.which){case 13:h()}}function g(){T.drawImage(J,0,0);var e=!0,t=!1,o=void 0;try{for(var n,a=ee[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){b(n.value)}}catch(e){t=!0,o=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw o}}var r=!0,l=!1,s=void 0;try{for(var d,c=te[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){A(d.value)}}catch(e){l=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw s}}p("x"+oe.items.now.key,M-4*H,ie),p("x"+oe.items.now.sword,M-H,ie),i()}function A(e){var t=j[e.type].sprites[e.frame];T.drawImage(se,t.x,t.y,H,H,Math.round(e.x),Math.round(e.y),H,H)}function b(e){var t=j[e.type].sprites[e.state];T.drawImage(se,t.x,t.y,H,H,Math.round(e.x),Math.round(e.y),H,H)}function p(e,t,o){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T,n=0;n<e.length;n++)i.drawImage(K,W.indexOf(e[n])*Q,0,Q,Q,t+n*Q,o,Q,Q)}function x(){requestAnimationFrame(function(){T.fillStyle=Y,T.fillRect(0,0,q.width,q.height),p(document.title.toLowerCase(),0,0),p("you are cursed. locked",0,2*Q),p("in an ever repeating",0,3*Q),p("room. unravel its",0,4*Q),p("mysteries to lift the",0,5*Q),p("curse and break free.",0,6*Q),p("press enter to start,",0,9*Q),p("arrows or wasd to move",0,10*Q),p("by jerome lecomte",0,13*Q),p("for cga-jam 2017",0,14*Q),i()})}function E(){oe.y=V.y,oe.items.now.key=oe.items.max.key,oe.items.now.sword=oe.items.max.sword;var e=!0,t=!1,o=void 0;try{for(var i,n=ee[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var a=i.value;"chest"!==a.type&&"crate"!==a.type||(a.state="initial",a.collide=!0)}}catch(e){t=!0,o=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw o}}}function k(){var e=Math.min(innerWidth/M,innerHeight/C);O.width=M*e,O.height=C*e,G.mozImageSmoothingEnabled=T.mozImageSmoothingEnabled=X.mozImageSmoothingEnabled=!1,G.mozImageSmoothingEnabled=T.msImageSmoothingEnabled=X.msImageSmoothingEnabled=!1,G.mozImageSmoothingEnabled=T.imageSmoothingEnabled=X.imageSmoothingEnabled=!1}function S(e,t){var o=e.speed*t;e.x+=o*(e.moveLeft+e.moveRight),e.y+=o*(e.moveUp+e.moveDown)}function I(e){le=e,le?(ne=Date.now(),u()):cancelAnimationFrame(ae)}function L(e){var t=o();t&&(t.leftX<=0?(oe.moveLeft=t.leftX,oe.moveRight=0):(oe.moveLeft=0,oe.moveRight=t.leftX),t.leftY<=0?(oe.moveUp=t.leftY,oe.moveDown=0):(oe.moveUp=0,oe.moveDown=t.leftY)),S(oe,e);var i=!0,n=!1,r=void 0;try{for(var l,d=ee[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var c=l.value;c!==oe&&(c!==V?c!==re?c!==$?c.collide&&oe.x+oe.bounds.x<c.x+H&&oe.x+oe.bounds.w>c.x&&oe.y+oe.bounds.y<c.y+H&&oe.y+oe.bounds.h>c.y&&(oe.moveRight&&(oe.x-=oe.x+oe.bounds.w-c.x),oe.moveLeft&&(oe.x+=c.x+H-oe.x-oe.bounds.x),oe.moveDown&&(oe.y-=oe.y+oe.bounds.h-c.y),oe.moveUp&&(oe.y+=c.y+H-oe.y-oe.bounds.y),"chest"===c.type&&"initial"===c.state&&oe.items.now.key?(c.state="altered",oe.items.now.key--,c.item&&(oe.items.now[c.item]++,oe.items.max[c.item]++,te.push(a(c.item,c.x,c.y-H)),c.item=void 0)):"crate"===c.type&&"initial"===c.state&&oe.items.now.sword&&(c.state="altered",c.collide=!1,oe.items.now.sword--)):oe.x+oe.bounds.w>$.x+H&&s():oe.y+oe.bounds.h>re.y+H&&E():oe.y+oe.bounds.y<V.y&&(oe.y=V.y-oe.bounds.y))}}catch(e){n=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(n)throw r}}var m=!0,v=!1,h=void 0;try{for(var w,y=te.entries()[Symbol.iterator]();!(m=(w=y.next()).done);m=!0){var u=_slicedToArray(w.value,2),f=u[0],g=u[1];g.nextFrame+=e,g.nextFrame>Z&&(g.nextFrame-=Z,++g.frame>=j[g.type].sprites.length&&te.splice(f,1))}}catch(e){v=!0,h=e}finally{try{!m&&y.return&&y.return()}finally{if(v)throw h}}}var D=0,B=1,U=0,R=1,_=2,F=3,P=void 0;navigator.getGamepads||(o=function(){}),document.title="Deja Vu";var Y="#000",C=160,M=176,H=16,Q=8,j={block:{sprites:{initial:{x:48,y:16}}},chest:{sprites:{initial:{x:80,y:0},altered:{x:96,y:0}}},crate:{sprites:{initial:{x:48,y:0},altered:{x:64,y:0}}},door_east:{sprites:{initial:{x:32,y:16}}},door_north:{sprites:{initial:{x:0,y:16}}},door_south:{sprites:{initial:{x:16,y:16}}},sword:{sprites:[{x:32,y:0}]},hero:{speed:30,bounds:{x:2,y:1,w:13,h:15},sprites:{initial:{x:0,y:0}}},key:{sprites:[{x:16,y:0}]},tile:{sprites:{initial:{x:64,y:16}}},wall_h:{sprites:{initial:{x:80,y:16}}},wall_v:{sprites:{initial:{x:96,y:16}}}},z=[["wall_h","wall_h","door_north","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"],["wall_v","block","tile","block","chest.sword","tile","crate","tile","tile","chest.sword","wall_v"],["wall_v","tile","tile","block","block","tile","tile","block","tile","tile","wall_v"],["wall_v","tile","tile","tile","crate","tile","crate","chest.key","block","crate","wall_v"],["wall_v","chest.sword","tile","tile","block","block","tile","tile","crate","crate","door_east"],["wall_v","tile","tile","block","block","block","crate","tile","block","crate","wall_v"],["wall_v","tile","tile","tile","crate","tile","tile","crate","tile","tile","wall_v"],["wall_v","block","tile","tile","tile","block","block","chest.key","block","chest.sword","wall_v"],["wall_h","wall_h","door_south","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"]],W="abcdefghijklmnopqrstuvwxyz0123456789.:!-%",O=document.querySelector("canvas"),X=O.getContext("2d"),q=document.createElement("canvas"),T=q.getContext("2d"),J=document.createElement("canvas"),G=J.getContext("2d"),Z=.4,K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUgAAAAICAYAAACbO2brAAAB5klEQVR42uVa2YrDMAw07Fvf9v8/tqWwhTZY18zI9tJAWlLHiqJjPHI1fm8/d/Qcf4c3js6t6JAdUz0T1eeqR1WX2RxLTsY3nh7s/BPP7DspZGbsw+iS0bUSi6gt0Pcf4oOR7+bX88M6Xjd1jL87cNXzo2vF8yP5M4DMzp9dWzaM7HsNCPX8Dv/svq7YSGXfyng2NqJ7Mr5Vvb8SIBHZr3mWPUc1gLsB5P33bwRIhf3+6/gOgNs1v0IQojzxYgPJrysDVfqPAUmPHXoAmWHY5kLR4WDPAYoEt+RbhsisgDM5MwMrAJQByJMZWHeCIfMzMVqNj4h9VfMnC4CI/hkZWYC24r9iX5bpWfMigIwYrJmnqxlEJ4NEACwCSFS+l0AewF+/T2VAEYBUFjJFfFl2VJSAlg8rDBBlcSiAov7PgoiVH0j8ZBgiM474F2IwihK1k0Eie3irtxgY+yifn9njUpSI0QrP7nGx9mf1W72FU8kDRfwp7OPlsYIhsiW2t+iPXQ5mAvyEAGZLLBQgmT9pvH/Su/bY0BKoAyAt+50M4Ih9WYas8F9Fv26ArJbuHxUI0+aws82nugnLtHFU2xtWtqlU2zSybRJM6wjS5sG0kTD+725z6Y6FqI1I1YbTPd5ZYmfbg2ZyHuewlwnHUW0vAAAAAElFTkSuQmCC",N=void 0,V=void 0,$=void 0,ee=void 0,te=void 0,oe=void 0,ie=void 0,ne=void 0,ae=void 0,re=void 0,le=void 0,se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAABQCAYAAADBTPF9AAAEmklEQVR42u2dia7lIAhA+5P+/6cwmWQWnwKyubWQ3GRe72BbjiDSen2ey6UAwM4PDL6b/T1lF0A+2wUa+QvQav3fTXr1vQC48xfB97idiIvdDe+HYcoZAL0AogEOL/gEeKUC+McTzZ8I/VkhUhK+O3godZBBxELcDHiF8MC6A9bHqX+3HoQBam3B6Vs9zNp5Wg/EwVXdpDoZa+jWyLPgSQBqAAy97XSAKLgGIgawNe6Pi2fEC28EsDUeBkwDcKR/BkD4n11hf3MAa+OOYnsLooYqhScNofV3bwbYD2Ol8xg2fHoBdsAE4RgDSMGTAiwgGxP//u39RALEchEWHpriA9772nGpa6fgk2NuLB15RHtsBFCT1EQBdMLvbNj1iuYYDrHwXoaBRHuOALQkhFIeOQKG6XMAOcht8kMlRlb9LorVoGpP0EBsDMD+Hy4RkmaxFADJlIID2P5bMwZSx9oOQo2RGv3OAWobQxOnR6HUO12gjC3NVrW1y9FEXKJPGZsa66QApfpoDXTQC+dWWpCwK/XAU0pp3DxSAlCjf0wxWwLrFoDSz2iaIdG//WnS403DI/S3ZqGjagnwhRn4un7UQ8UCAo/EsnxXNbw4q+mB+mbjB5yfKnzgJ8WPse3CywFqIRage7X2/Jr74WBZj5EAqXAjvWCvvsUDiiXsJcD5AEEawqTQTwPoGBevAQiHAgx7M8o4Lh4FUJM5HgNQm7QQafArQqg6/T8EoOv7BPhSgNZ5oCWERenfGkJneaB5HigxHneBXv0vJjE5jTghiQmuxLgAil5MHYUIp75pIi+o4H9iHnhlKU3xGOa0Skz4PPC6YrbhWdorSmm7H0jerr89iUlJSUlJSUnBF5rsbCOqLe+6RYue55pd9wsBWU47g5/xzqhF39KO5fyea3bdr7SuqerxSmNJ6qei1TjEIhttOxb4ENBZTPaHwVOGVTfATZApw0uXslnaGZ1/xv2DcFleAnwjwEKsFFoNcLRkbbQ4BlvqXYQAqYUmy0OoIPST6/z+/ZRHWQ+wPveoLaweit2Pph3OHlOTmEIv9BG3h67fK7qs0pKBkmsHB21p1iRK2om8l8iFPhFZfUpKSkpKSkrKPWKpbYKxDmipoQLIsszVNdyojNF9XbBhImupoUYU4SNeV4Dg1x7CCtynVuMB5D/NtcL4kQDdbd0EMALiqwCuDoVvgXhMKL4JYCTEVwDcaYCZEKWZnPf+vdnsNu87YRzhIFozac00xZtNu7JqOCQRoIxo0dU+kO6y27JhGmWFV5hnazsAejoUAL7BhqczSwHCwvORDRRjHI8aA6j1AZbOZPEiIFbTzgYYAtHyJHraGOjoSNg7LdrfIYUN82CT/SNDaERNMSKE1h5jKQlazh81/XJ53ylF4SlFZpg7JLhDaL468SFxrXE/4PsECI4VrAEAZuyf9ykpDgAr9sdLgAs8cKd+euBmD4reeiYBbgD4BG/+lAAXelACnJjErACQAAMAPps3zkiAmz3wpP3zPjmTeBz73x2gnx64c/+7yP3zEuCG/e+i989LgIv3v5u1f17OAy/5uccEmFno1fILjM8aJIZzqx4AAAAASUVORK5CYII=";addEventListener("load",d)}();
//# sourceMappingURL=game.js.map</script></body></html>