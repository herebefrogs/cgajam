<html><head><style>body {
    margin: 0;
    text-align: center;
    background-color: #000;
  }</style></head><body><canvas></canvas><script>"use strict";var _slicedToArray=function(){function e(e,t){var a=[],i=!0,n=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){n=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw o}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,a){(a||navigator.getGamepads())[e.gamepad.index]&&e.gamepad.connected?(console.log("[gamepad] connecting",e.gamepad),D=e.gamepad):t({gamepad:{index:e.gamepad.index,connected:!1}})}function t(e){D&&D.index===e.gamepad.index&&!e.gamepad.connected&&(console.log("[gamepad] disconnecting",D),D=void 0)}function a(){var t=navigator.getGamepads();if(!D){var a=!0,i=!1,n=void 0;try{for(var o,r=t[Symbol.iterator]();!(a=(o=r.next()).done);a=!0){var l=o.value;if(l&&l.connected){e({gamepad:l},t);break}}}catch(e){i=!0,n=e}finally{try{!a&&r.return&&r.return()}finally{if(i)throw n}}}if(D)return{leftX:Math.round(100*D.axes[_])/100,leftY:Math.round(100*D.axes[I])/100,buttonA:D.buttons[E].pressed,buttonB:D.buttons[M].pressed,buttonX:D.buttons[L].pressed,buttonY:D.buttons[U].pressed}}function i(){H.drawImage(Q,0,0,Q.width,Q.height,0,0,j.width,j.height)}function n(e){e.target.hidden&&D&&t({gamepad:{index:D.index,connected:!1}}),k(!event.target.hidden)}function o(e,t,a){return{frame:0,nextFrame:0,type:e,x:t,y:a}}function r(e,t,a,i){return{collide:e.indexOf("door")===-1,item:i,state:"initial",type:e,x:t*Y,y:a*Y}}function l(){return{moveDown:0,moveLeft:0,moveRight:0,moveUp:0,items:{now:{key:1,hammer:0},max:{key:1,hammer:0}},speed:P.hero.speed,state:"initial",type:"hero",x:J.x,y:J.y}}function m(){A("you won!",(Z.x+Y)/2-4*C,Z.y+C/2),i(),k(!1)}function s(){addEventListener("resize",p),Q.width=B,Q.height=F,W.width=B,W.height=F,p(),y(re).then(function(e){re=e}).then(function(){return y(V)}).then(function(e){V=e}).then(v)}function c(e){switch(e.which){case 37:case 65:case 81:N.moveLeft=-1,N.moveUp=N.moveDown=0;break;case 38:case 90:case 87:N.moveUp=-1,N.moveLeft=N.moveRight=0;break;case 39:case 68:N.moveRight=1,N.moveUp=N.moveDown=0;break;case 40:case 83:N.moveDown=1,N.moveLeft=N.moveRight=0;break;case 80:k(!oe)}}function d(e){switch(e.which){case 37:case 65:case 81:N.moveLeft=0;break;case 38:case 90:case 87:N.moveUp=0;break;case 39:case 68:N.moveRight=0;break;case 40:case 83:N.moveDown=0}}function v(){addEventListener("keydown",c),addEventListener("keyup",d),addEventListener("gamepadconnected",e),addEventListener("gamepaddisconnected",t),document.addEventListener("visibilitychange",n),K=[],O=[],h(z),k(!0)}function h(e){G.fillStyle="#000",G.fillRect(0,0,W.width,W.height);var t=void 0,a=void 0;for(a=0;a<e.length;a++)for(t=0;t<e[a].length;t++){var i=e[a][t].split("."),n=_slicedToArray(i,2),o=n[0],m=n[1];if("tile"!==o){var s=r(o,t,a,m);"door_north"===o?J=s:"door_south"===o?ne=s:"door_east"===o&&(Z=s),K.push(s)}var c=P[o].sprites.initial;G.drawImage(re,c.x,c.y,Y,Y,t*Y,a*Y,Y,Y)}N=l(),K.push(N),$=a*Y+C/2;var d=6*C;ee=d+Y,te=ee+2*Y,A("items",0,$,G);var v=P.key.sprites[0];G.drawImage(re,v.x,v.y,Y,Y,d,$-C/2,Y,Y),v=P.hammer.sprites[0],G.drawImage(re,v.x,v.y,Y,Y,te-Y,$-C/2,Y,Y)}function y(e){return new Promise(function(t){var a=new Image;a.addEventListener("load",function(){t(a)}),a.src=e})}function u(){oe&&(ie=requestAnimationFrame(u),f(),X=Date.now(),S((X-ae)/1e3),ae=X)}function f(){T.drawImage(W,0,0);var e=!0,t=!1,a=void 0;try{for(var n,o=K[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){g(n.value)}}catch(e){t=!0,a=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw a}}var r=!0,l=!1,m=void 0;try{for(var s,c=O[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){w(s.value)}}catch(e){l=!0,m=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw m}}A("x"+N.items.now.key,ee,$),A("x"+N.items.now.hammer,te,$),i()}function w(e){var t=P[e.type].sprites[e.frame];T.drawImage(re,t.x,t.y,Y,Y,Math.round(e.x),Math.round(e.y),Y,Y)}function g(e){var t=P[e.type].sprites[e.state];T.drawImage(re,t.x,t.y,Y,Y,Math.round(e.x),Math.round(e.y),Y,Y)}function A(e,t,a){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T,n=0;n<e.length;n++)i.drawImage(V,R.indexOf(e[n])*C,0,C,C,t+n*C,a,C,C)}function x(){N.y=J.y,N.items.now.key=N.items.max.key,N.items.now.hammer=N.items.max.hammer;var e=!0,t=!1,a=void 0;try{for(var i,n=K[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var o=i.value;"chest"!==o.type&&"crate"!==o.type||(o.state="initial",o.collide=!0)}}catch(e){t=!0,a=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw a}}}function p(){var e=Math.min(innerWidth/B,innerHeight/F);j.width=B*e,j.height=F*e,G.mozImageSmoothingEnabled=T.mozImageSmoothingEnabled=H.mozImageSmoothingEnabled=!1,G.mozImageSmoothingEnabled=T.msImageSmoothingEnabled=H.msImageSmoothingEnabled=!1,G.mozImageSmoothingEnabled=T.imageSmoothingEnabled=H.imageSmoothingEnabled=!1}function b(e,t){var a=e.speed*t;e.x+=a*(e.moveLeft+e.moveRight),e.y+=a*(e.moveUp+e.moveDown)}function k(e){oe=e,oe?(ae=Date.now(),u()):cancelAnimationFrame(ie)}function S(e){var t=a();t&&(t.leftX<=0?(N.moveLeft=t.leftX,N.moveRight=0):(N.moveLeft=0,N.moveRight=t.leftX),t.leftY<=0?(N.moveUp=t.leftY,N.moveDown=0):(N.moveUp=0,N.moveDown=t.leftY)),b(N,e);var i=!0,n=!1,r=void 0;try{for(var l,s=K[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value;c!==N&&(c!==J?c!==ne?c!==Z?c.collide&&N.x<c.x+Y&&N.x+Y>c.x&&N.y<c.y+Y&&N.y+Y>c.y&&(N.moveRight&&(N.x-=N.x+Y-c.x),N.moveLeft&&(N.x+=c.x+Y-N.x),N.moveDown&&(N.y-=N.y+Y-c.y),N.moveUp&&(N.y+=c.y+Y-N.y),"chest"===c.type&&"initial"===c.state&&N.items.now.key?(c.state="altered",N.items.now.key--,c.item&&(N.items.now[c.item]++,N.items.max[c.item]++,O.push(o(c.item,c.x,c.y-Y)),c.item=void 0)):"crate"===c.type&&"initial"===c.state&&N.items.now.hammer&&(c.state="altered",c.collide=!1,N.items.now.hammer--)):N.x>Z.x&&m():N.y>ne.y&&x():N.y<J.y&&(N.y=J.y))}}catch(e){n=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}var d=!0,v=!1,h=void 0;try{for(var y,u=O.entries()[Symbol.iterator]();!(d=(y=u.next()).done);d=!0){var f=_slicedToArray(y.value,2),w=f[0],g=f[1];g.nextFrame+=e,g.nextFrame>q&&(g.nextFrame-=q,++g.frame>=P[g.type].sprites.length&&O.splice(w,1))}}catch(e){v=!0,h=e}finally{try{!d&&u.return&&u.return()}finally{if(v)throw h}}}var _=0,I=1,E=0,M=1,L=2,U=3,D=void 0;navigator.getGamepads||(a=function(){}),document.title="CGA Jam";var F=160,B=176,Y=16,C=8,P={block:{sprites:{initial:{x:48,y:16}}},chest:{sprites:{initial:{x:80,y:0},altered:{x:96,y:0}}},crate:{sprites:{initial:{x:48,y:0},altered:{x:64,y:0}}},door_east:{sprites:{initial:{x:32,y:16}}},door_north:{sprites:{initial:{x:0,y:16}}},door_south:{sprites:{initial:{x:16,y:16}}},hammer:{sprites:[{x:32,y:0}]},hero:{speed:30,sprites:{initial:{x:0,y:0}}},key:{sprites:[{x:16,y:0}]},tile:{sprites:{initial:{x:64,y:16}}},wall_h:{sprites:{initial:{x:80,y:16}}},wall_v:{sprites:{initial:{x:96,y:16}}}},z=[["wall_h","wall_h","door_north","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"],["wall_v","block","tile","block","chest.hammer","tile","crate","tile","tile","chest.hammer","wall_v"],["wall_v","tile","tile","block","block","tile","tile","block","tile","tile","wall_v"],["wall_v","tile","tile","tile","crate","tile","crate","chest.key","block","crate","wall_v"],["wall_v","chest.hammer","tile","tile","block","block","tile","tile","crate","crate","door_east"],["wall_v","tile","tile","block","block","block","crate","tile","block","crate","wall_v"],["wall_v","tile","tile","tile","crate","tile","tile","crate","tile","tile","wall_v"],["wall_v","block","tile","tile","tile","block","block","chest.key","block","chest.hammer","wall_v"],["wall_h","wall_h","door_south","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"]],R="abcdefghijklmnopqrstuvwxyz0123456789.:!-%",j=document.querySelector("canvas"),H=j.getContext("2d"),Q=document.createElement("canvas"),T=Q.getContext("2d"),W=document.createElement("canvas"),G=W.getContext("2d"),q=.4,V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUgAAAAICAYAAACbO2brAAAB5klEQVR42uVa2YrDMAw07Fvf9v8/tqWwhTZY18zI9tJAWlLHiqJjPHI1fm8/d/Qcf4c3js6t6JAdUz0T1eeqR1WX2RxLTsY3nh7s/BPP7DspZGbsw+iS0bUSi6gt0Pcf4oOR7+bX88M6Xjd1jL87cNXzo2vF8yP5M4DMzp9dWzaM7HsNCPX8Dv/svq7YSGXfyng2NqJ7Mr5Vvb8SIBHZr3mWPUc1gLsB5P33bwRIhf3+6/gOgNs1v0IQojzxYgPJrysDVfqPAUmPHXoAmWHY5kLR4WDPAYoEt+RbhsisgDM5MwMrAJQByJMZWHeCIfMzMVqNj4h9VfMnC4CI/hkZWYC24r9iX5bpWfMigIwYrJmnqxlEJ4NEACwCSFS+l0AewF+/T2VAEYBUFjJFfFl2VJSAlg8rDBBlcSiAov7PgoiVH0j8ZBgiM474F2IwihK1k0Eie3irtxgY+yifn9njUpSI0QrP7nGx9mf1W72FU8kDRfwp7OPlsYIhsiW2t+iPXQ5mAvyEAGZLLBQgmT9pvH/Su/bY0BKoAyAt+50M4Ih9WYas8F9Fv26ArJbuHxUI0+aws82nugnLtHFU2xtWtqlU2zSybRJM6wjS5sG0kTD+725z6Y6FqI1I1YbTPd5ZYmfbg2ZyHuewlwnHUW0vAAAAAElFTkSuQmCC",X=void 0,J=void 0,Z=void 0,K=void 0,O=void 0,N=void 0,$=void 0,ee=void 0,te=void 0,ae=void 0,ie=void 0,ne=void 0,oe=void 0,re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAACZElEQVR42u2aCY7DIAxFe0nuf5Q/GqnTSY13TAJpI0VqQx1SP7ySx0M+wJzLHQ3AlSeMsdnjIjhOYjZEOA8KMKv93ylH5UcBaPM3x3ivw8PgmQAjenw+yxIARwGUA2SFMB8iIiv3APBpkemzQn6Wi/S47w4eOwPeiMPrAjMAEQTYyOLiPIj0mf5nDhDViSaftbDs4qEWyIMjGpUAwlB0FGArAhgBYFrbFgDxH5wPlqQCBPqHtdZCZ/4FMZACpMrjgEUAWvJXAzQTQcv6aGzyQugCsJ08PCIu9Dh2d4AiRCv2VQCkMD2/5QBK8LwAG3wxMbDm1LPUAqUbNvjiH41hXPyZCdBymxbASFJTBXAQfu/BXg9KvqsQm5HuMyBnWaBmkRYwTl4DqEGmyY+UGGXlqV46WCBmbpYRSqzifjMToKek0ADSz5EYKF2jC0SKkRF5tvcpATyzJ+oFiIHepVWIe+QlZUuxzgvQK98lL86uxTIAV2ylaXWkB2BEXm1kC27ktMPjalfuhVqnVWZ45LfeSvoDOJKGV8hfmoVa3RLonTV8unzVpmKDwyK5LH+oG94Gu+mF8mnlF8z/flNrUv6ael/cHGAUYoO8qqPzR/6PBit7TQQIx9aO9sCj8hkLaBm39wU4HyC8LswLfTWAA3FxG4BYFGDZm1HJuLgUwEjmuAzAaNIipMG3cKHh9H8RgEPjX4A3BZitAzMurEp+Vxc6ywLTdaBHedoDjsp/YhLzLSNWSGKKOzFDAL0v2M6UTxXyjg7+R9SBW7bSAtswq3ViyuvA7ZrZib20W7TSrt6Q3F3+6iTmBwuUWXZpC1bSAAAAAElFTkSuQmCC";addEventListener("load",s)}();
//# sourceMappingURL=game.js.map</script></body></html>