<html><head><style>body {
    margin: 0;
    text-align: center;
    background-color: #000;
  }</style></head><body><canvas></canvas><script>"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(){J.drawImage(j,0,0,j.width,j.height,0,0,D.width,D.height)}function t(e){k(!event.target.hidden)}function n(e,t,n,i){return{callback:i,frame:0,nextFrame:0,type:e,x:t,y:n}}function i(e,t,n,i){return{collide:e.indexOf("door")===-1,item:i,initialState:!0,type:e,x:t*F,y:n*F}}function a(){return{initialState:!0,items:{now:{key:1,sword:0},max:{key:1,sword:0}},lastInput:null,moveDown:0,moveLeft:0,moveRight:0,moveUp:0,nbLevelResets:0,nbMoves:0,speed:C.hero.speed,type:"hero",x:Y.x,y:Y.y}}function o(){A("you won!",(K.x+F)/2-4*L,K.y+L/2),e(),k(!1),ga("send","event","deja-vu|level:1","game end","level resets:"+G.nbLevelResets+"|moves:"+G.nbMoves)}function r(){addEventListener("resize",p),j.width=E,j.height=M,V.width=E,V.height=M,p(),d(O).then(function(e){O=e}).then(function(){return d(Q)}).then(function(e){Q=e}).then(c)}function l(e){if(80===e.which)k(!Z);else if(!G.lastInput)switch(e.which){case 37:case 65:case 81:G.moveLeft=-1,G.lastInput=e.which;break;case 38:case 90:case 87:G.moveUp=-1,G.lastInput=e.which,e.preventDefault();break;case 39:case 68:G.moveRight=1,G.lastInput=e.which;break;case 40:case 83:G.moveDown=1,G.lastInput=e.which,e.preventDefault()}}function s(e){if(G.lastInput===e.which)switch(e.which){case 37:case 65:case 81:G.lastInput=null;break;case 38:case 90:case 87:G.lastInput=null;break;case 39:case 68:G.lastInput=null;break;case 40:case 83:G.lastInput=null}}function c(){addEventListener("keydown",m),addEventListener("resize",g),g(),ga("send","event","deja-vu|splash screen")}function y(){removeEventListener("keydown",m),removeEventListener("resize",g),addEventListener("keydown",l),addEventListener("keyup",s),document.addEventListener("visibilitychange",t),N=[],P=[],u(_),k(!0),ga("send","event","deja-vu|level:1","game start")}function u(e){T.fillStyle=I,T.fillRect(0,0,V.width,V.height);var t=void 0,n=void 0;for(n=0;n<e.length;n++)for(t=0;t<e[n].length;t++){var o=e[n][t].split("."),r=_slicedToArray(o,2),l=r[0],s=r[1];if("tile"!==l){var c=i(l,t,n,s);"door_north"===l?Y=c:"door_south"===l?q=c:"door_east"===l&&(K=c),N.push(c)}var y=C[l].sprites[0];T.drawImage(O,y.x,y.y,F,F,t*F,n*F,F,F)}G=a(),N.push(G),B=n*F+L/2,A("items",0,B,T);var u=C.key.sprites[0];T.drawImage(O,u.x,u.y,F,F,E-5*F,B-L/2,F,F),u=C.sword.sprites[0],T.drawImage(O,u.x,u.y,F,F,E-2*F,B-L/2,F,F)}function d(e){return new Promise(function(t){var n=new Image;n.addEventListener("load",function(){t(n)}),n.src=e})}function v(){Z&&(X=requestAnimationFrame(v),h(),W=Date.now(),S((W-H)/1e3),H=W)}function m(e){switch(e.which){case 13:y()}}function h(){U.drawImage(V,0,0);var t=!0,n=!1,i=void 0;try{for(var a,o=N[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){f(a.value)}}catch(e){n=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}var r=!0,l=!1,s=void 0;try{for(var c,y=P[Symbol.iterator]();!(r=(c=y.next()).done);r=!0){w(c.value)}}catch(e){l=!0,s=e}finally{try{!r&&y.return&&y.return()}finally{if(l)throw s}}A("x"+G.items.now.key,E-4*F,B),A("x"+G.items.now.sword,E-F,B),e()}function w(e){var t=C[e.type].sprites[e.frame];U.drawImage(O,t.x,t.y,F,F,Math.round(e.x),Math.round(e.y),F,F)}function f(e){var t=C[e.type].sprites,n=t[e.initialState?0:t.length-1];U.drawImage(O,n.x,n.y,F,F,Math.round(e.x),Math.round(e.y),F,F)}function A(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:U,a=0;a<e.length;a++)i.drawImage(Q,z.indexOf(e[a])*L,0,L,L,t+a*L,n,L,L)}function g(){requestAnimationFrame(function(){U.fillStyle=I,U.fillRect(0,0,j.width,j.height),A(document.title.toLowerCase(),0,0),A("you are cursed. locked",0,2*L),A("in an ever repeating",0,3*L),A("room. unravel its",0,4*L),A("mysteries to lift the",0,5*L),A("curse and break free.",0,6*L),A("press enter to start,",0,9*L),A("arrows or wasd to move",0,10*L),A("by jerome lecomte",0,13*L),A("for cga-jam 2017",0,14*L),e()})}function x(){G.nbLevelResets++,G.nbMoves++,G.y=Y.y,G.items.now.key=G.items.max.key,G.items.now.sword=G.items.max.sword;var e=!0,t=!1,n=void 0;try{for(var i,a=N[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;"chest"!==o.type&&"crate"!==o.type||(o.initialState=!0,o.collide=!0)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}function p(){var e=Math.min(innerWidth/E,innerHeight/M);D.width=E*e,D.height=M*e,T.mozImageSmoothingEnabled=U.mozImageSmoothingEnabled=J.mozImageSmoothingEnabled=!1,T.mozImageSmoothingEnabled=U.msImageSmoothingEnabled=J.msImageSmoothingEnabled=!1,T.mozImageSmoothingEnabled=U.imageSmoothingEnabled=J.imageSmoothingEnabled=!1}function b(e){G.x+=F*(G.moveLeft+G.moveRight),G.y+=F*(G.moveUp+G.moveDown)}function k(e){Z=e,Z?(H=Date.now(),v()):cancelAnimationFrame(X)}function S(e){var t=G.x,i=G.y;b(e);var a=!0,r=!1,l=void 0;try{for(var s,c=N[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var y=function(){var e=s.value;return e===G?"continue":e===Y?(G.y<Y.y&&(G.y=Y.y),"continue"):e===q?G.y>q.y?(x(),{v:void 0}):"continue":e===K?G.x>K.x?(o(),{v:void 0}):"continue":void(e.collide&&G.x<e.x+F&&G.x+F>e.x&&G.y<e.y+F&&G.y+F>e.y&&(G.moveRight&&(G.x-=G.x+F-e.x),G.moveLeft&&(G.x+=e.x+F-G.x),G.moveDown&&(G.y-=G.y+F-e.y),G.moveUp&&(G.y+=e.y+F-G.y),"chest"===e.type&&e.initialState&&G.items.now.key?(e.initialState=!e.initialState,G.items.now.key--,P.push(n(e.type,e.x,e.y,function(){e.item&&(G.items.now[e.item]++,G.items.max[e.item]++,P.push(n(e.item,e.x,e.y-F)),e.item=void 0)}))):"crate"===e.type&&e.initialState&&G.items.now.sword&&(e.initialState=!e.initialState,e.collide=!1,G.items.now.sword--)))}();switch(y){case"continue":continue;default:if("object"===(void 0===y?"undefined":_typeof(y)))return y.v}}}catch(e){r=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(r)throw l}}var u=!0,d=!1,v=void 0;try{for(var m,h=P.entries()[Symbol.iterator]();!(u=(m=h.next()).done);u=!0){var w=_slicedToArray(m.value,2),f=w[0],A=w[1];A.nextFrame+=e,A.nextFrame>R&&(A.nextFrame-=R,++A.frame>=C[A.type].sprites.length&&(P.splice(f,1),A.callback&&A.callback()))}}catch(e){d=!0,v=e}finally{try{!u&&h.return&&h.return()}finally{if(d)throw v}}G.moveLeft=G.moveRight=G.moveUp=G.moveDown=0,t===G.x&&i===G.y||G.nbMoves++}!function(e,t,n,i,a,o,r){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,o=t.createElement(n),r=t.getElementsByTagName(n)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",r.parentNode.insertBefore(o,r)}(window,document,"script",0,"ga"),ga("create","UA-39675296-3","auto"),ga("send","pageview"),document.title="Deja Vu";var I="#000",M=160,E=176,F=16,L=8,R=.1,C={block:{sprites:[{x:48,y:16}]},chest:{sprites:[{x:80,y:0},{x:0,y:64},{x:16,y:64},{x:96,y:0}]},crate:{sprites:[{x:48,y:0},{x:64,y:0}]},door_east:{sprites:[{x:32,y:16}]},door_north:{sprites:[{x:0,y:16}]},door_south:{sprites:[{x:16,y:16}]},hero:{speed:30,sprites:[{x:0,y:0}]},key:{sprites:[{x:16,y:0},{x:0,y:32},{x:16,y:32},{x:32,y:32},{x:48,y:32},{x:64,y:32},{x:80,y:32},{x:96,y:32},{x:16,y:0}]},sword:{sprites:[{x:32,y:0},{x:0,y:48},{x:16,y:48},{x:32,y:48},{x:48,y:48},{x:64,y:48},{x:80,y:48},{x:96,y:48},{x:32,y:0}]},tile:{sprites:[{x:64,y:16}]},wall_h:{sprites:[{x:80,y:16}]},wall_v:{sprites:[{x:96,y:16}]}},_=[["wall_h","wall_h","door_north","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"],["wall_v","block","tile","block","chest.sword","tile","crate","tile","tile","chest.sword","wall_v"],["wall_v","tile","tile","block","block","tile","tile","block","tile","tile","wall_v"],["wall_v","tile","tile","tile","crate","tile","crate","chest.key","block","crate","wall_v"],["wall_v","chest.sword","tile","tile","block","block","tile","tile","crate","crate","door_east"],["wall_v","tile","tile","block","block","block","crate","tile","block","crate","wall_v"],["wall_v","tile","tile","tile","crate","tile","tile","crate","tile","tile","wall_v"],["wall_v","block","tile","tile","tile","block","block","chest.key","block","chest.sword","wall_v"],["wall_h","wall_h","door_south","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"]],z="abcdefghijklmnopqrstuvwxyz0123456789.:!-%",D=document.querySelector("canvas"),J=D.getContext("2d"),j=document.createElement("canvas"),U=j.getContext("2d"),V=document.createElement("canvas"),T=V.getContext("2d"),Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUgAAAAICAYAAACbO2brAAAB5klEQVR42uVa2YrDMAw07Fvf9v8/tqWwhTZY18zI9tJAWlLHiqJjPHI1fm8/d/Qcf4c3js6t6JAdUz0T1eeqR1WX2RxLTsY3nh7s/BPP7DspZGbsw+iS0bUSi6gt0Pcf4oOR7+bX88M6Xjd1jL87cNXzo2vF8yP5M4DMzp9dWzaM7HsNCPX8Dv/svq7YSGXfyng2NqJ7Mr5Vvb8SIBHZr3mWPUc1gLsB5P33bwRIhf3+6/gOgNs1v0IQojzxYgPJrysDVfqPAUmPHXoAmWHY5kLR4WDPAYoEt+RbhsisgDM5MwMrAJQByJMZWHeCIfMzMVqNj4h9VfMnC4CI/hkZWYC24r9iX5bpWfMigIwYrJmnqxlEJ4NEACwCSFS+l0AewF+/T2VAEYBUFjJFfFl2VJSAlg8rDBBlcSiAov7PgoiVH0j8ZBgiM474F2IwihK1k0Eie3irtxgY+yifn9njUpSI0QrP7nGx9mf1W72FU8kDRfwp7OPlsYIhsiW2t+iPXQ5mAvyEAGZLLBQgmT9pvH/Su/bY0BKoAyAt+50M4Ih9WYas8F9Fv26ArJbuHxUI0+aws82nugnLtHFU2xtWtqlU2zSybRJM6wjS5sG0kTD+725z6Y6FqI1I1YbTPd5ZYmfbg2ZyHuewlwnHUW0vAAAAAElFTkSuQmCC",W=void 0,Y=void 0,K=void 0,N=void 0,P=void 0,G=void 0,B=void 0,H=void 0,X=void 0,q=void 0,Z=void 0,O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAABQCAYAAADBTPF9AAAEzUlEQVR42u2djY7kIAiA+5K+/6NwueQ251KQX3/aYjLJzsxSLZ8g4liv6+GlAcDOFwjfzf6e0wsQr+0FUPkB6NX+30tG5aMARvU3xfe0npjG7ob3SzHtDIBRANkAxQafAK91AP9ZovuVIT/LRWrc9w0eSR10ECkXNwNeYyyw74D959zf2IIoQFgXI3mvhXk7D7ZAGlzXTbrKhorGSp4FTwPQAkC0ttMBkuAQRAogVu6vxg9KFJ4EECuPAmYBKMmfARD+R1fU+xHAXrmSb8cgeqhaeFoX2n/3ZoD3YazdLGboPqMAb8AU7pgCyMHTAmygGxN/3kdfmQCpWGQIjwzxge59eFy6XafRk+PRWCpZBP5MAmgJarIABuHfdHjrFegzGmIbWxkFkuw5CtAaF8pZpASMkh8BHEHGwY/FsgzyNLzeEiwQkQKG/zMKhLRRLAdAM6UYAcR/W8ZA7jPcQbgx0iJ/M4Bex4D8tORKo9MFTtnaaNWau5Qm4hp5TtncWKcFqJUnc6BCL5ybaSHcrtYCT0mljeaRGoAW+WOS2RpYTwGofUnTDI3801eTrmgYniG/NQqVsiUwTszA1+WzFhUbKCySivJD2fAWzKYnyruVn1A/l/igK6U/G14XXg7QCrEB36ut9VvuZwTL+xkLkHM32gZH5T0W0DxurwDOBwhaF6aFfhrAwLj4GIBwKMC0X0Y5x8WjAFoix2MAWoMWJgx+hQs1h/+HAAx9XwBfCtA7D/S4sCz5p7rQWRbongdqlDdqYFT+i0FMTSNOCGKSMzEhgKofpkouIijvmsgrMvifmAc+MpVmWIY5LROTPg98XDLbsZb2ilTa7gXJp8tvD2KqVKlSpUqVKvRGk4zt0LvbE9m3GJVbrjtIiHIA5F9or2pPZN8iJMhZ2xyKNLV5zZkK0+RPVbtxmE02lutQ8z3NvXgBsnVq9Q+DVQJtg7J6/G2eJiheu5XNep1+L/4qgLhOtS4L4EsANqPrmeVCpC1r0uYYyg01JUAsu/z+vS6c+uddALV1U/lQ6n4s16FklwQxTJ2WLXfkRhNrVOmJQtm9g8J1LHsSNdeJ3kdks05ED1WqVKlSpUqVKu8pVG7Jkg911dV8dUWjNOs9Zt+/VjeuZLAnE2GeRjgeM9IrKyMJn/6Qvpb71MZ4ctuQSvOA8KThwJl0ngUxG6C7TRHr8wD0WmFk5WCG8jMBQurS0kKAGfVG1+NC66GweT3UY30ZAKNj4SyI2iApaz003JmyVpVXuyEJogeCpTOkLadlrMzDAQCjbhgr3xtJW905BKLw/sn8+hWILNNNHMRHrsw6lrqmJsQa4wrv1T83VV0vEAufJ0VhlicYjjyJF0J0XdML0XSNSKNnRmEZ47FnHPO4z+j9c79KMEE8YS6V0aE465Xa1ddlfYJwRhCD67K70eafAmTmAqPtwT/Dc1lT2xSFNufUAfe+rQCbfR5muaZVxhOBZv2spMpbS2iP+wHfF0AI7GBNADDj/LxPlRYAsOJ8vAK4wAJ3ypcFbrag7KNnCuAGgFfy4U8FcKEFFcCJQcwKAAUwAeC1+eCMArjZAk86P++TM4lr7/l3aefnVRCz4fy7zPPzCuCG8++yz88rgIvPv5t1fl7NAx/yuMcCWFHoo8sfuQmaToXnHdAAAAAASUVORK5CYII=";addEventListener("load",r)}();
//# sourceMappingURL=game.js.map</script></body></html>