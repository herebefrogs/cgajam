<html><head><style>body {
    margin: 0;
    text-align: center;
    background-color: #000;
  }</style></head><body><canvas></canvas><script>"use strict";var _slicedToArray=function(){function e(e,t){var n=[],o=!0,a=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function e(e,n){(n||navigator.getGamepads())[e.gamepad.index]&&e.gamepad.connected?(console.log("[gamepad] connecting",e.gamepad),_=e.gamepad):t({gamepad:{index:e.gamepad.index,connected:!1}})}function t(e){_&&_.index===e.gamepad.index&&!e.gamepad.connected&&(console.log("[gamepad] disconnecting",_),_=void 0)}function n(){var t=navigator.getGamepads();if(!_){var n=!0,o=!1,a=void 0;try{for(var i,r=t[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if(l&&l.connected){e({gamepad:l},t);break}}}catch(e){o=!0,a=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw a}}}if(_)return{leftX:Math.round(100*_.axes[I])/100,leftY:Math.round(100*_.axes[F])/100,buttonA:_.buttons[R].pressed,buttonB:_.buttons[C].pressed,buttonX:_.buttons[D].pressed,buttonY:_.buttons[U].pressed}}function o(){j.drawImage(N,0,0,N.width,N.height,0,0,P.width,P.height)}function a(e){e.target.hidden&&_&&t({gamepad:{index:_.index,connected:!1}}),M(!event.target.hidden)}function i(e,t,n,o){return{callback:o,frame:0,nextFrame:0,type:e,x:t,y:n}}function r(e,t,n,o){return{collide:e.indexOf("door")===-1,item:o,initialState:!0,type:e,x:t*V,y:n*V}}function l(){return{bounds:W.hero.bounds,moveDown:0,moveLeft:0,moveRight:0,moveUp:0,items:{now:{key:1,sword:0},max:{key:1,sword:0}},speed:W.hero.speed,initialState:!0,type:"hero",x:O.x,y:O.y}}function s(){p("you won!",($.x+V)/2-4*Q,$.y+Q/2),o(),M(!1)}function d(){addEventListener("resize",S),N.width=J,N.height=Y,H.width=J,H.height=Y,S(),h(se).then(function(e){se=e}).then(function(){return h(Z)}).then(function(e){Z=e}).then(v)}function c(e){switch(e.which){case 37:case 65:case 81:ne.moveLeft=-1,ne.moveUp=ne.moveDown=0;break;case 38:case 90:case 87:ne.moveUp=-1,ne.moveLeft=ne.moveRight=0,e.preventDefault();break;case 39:case 68:ne.moveRight=1,ne.moveUp=ne.moveDown=0;break;case 40:case 83:ne.moveDown=1,ne.moveLeft=ne.moveRight=0,e.preventDefault();break;case 80:M(!le)}}function m(e){switch(e.which){case 37:case 65:case 81:ne.moveLeft=0;break;case 38:case 90:case 87:ne.moveUp=0;break;case 39:case 68:ne.moveRight=0;break;case 40:case 83:ne.moveDown=0}}function v(){addEventListener("keydown",f),addEventListener("resize",b),b()}function y(){removeEventListener("keydown",f),removeEventListener("resize",b),addEventListener("keydown",c),addEventListener("keyup",m),addEventListener("gamepadconnected",e),addEventListener("gamepaddisconnected",t),document.addEventListener("visibilitychange",a),ee=[],te=[],u(G),M(!0)}function u(e){B.fillStyle=z,B.fillRect(0,0,H.width,H.height);var t=void 0,n=void 0;for(n=0;n<e.length;n++)for(t=0;t<e[n].length;t++){var o=e[n][t].split("."),a=_slicedToArray(o,2),i=a[0],s=a[1];if("tile"!==i){var d=r(i,t,n,s);"door_north"===i?O=d:"door_south"===i?re=d:"door_east"===i&&($=d),ee.push(d)}var c=W[i].sprites[0];B.drawImage(se,c.x,c.y,V,V,t*V,n*V,V,V)}ne=l(),ee.push(ne),oe=n*V+Q/2,p("items",0,oe,B);var m=W.key.sprites[0];B.drawImage(se,m.x,m.y,V,V,J-5*V,oe-Q/2,V,V),m=W.sword.sprites[0],B.drawImage(se,m.x,m.y,V,V,J-2*V,oe-Q/2,V,V)}function h(e){return new Promise(function(t){var n=new Image;n.addEventListener("load",function(){t(n)}),n.src=e})}function w(){le&&(ie=requestAnimationFrame(w),g(),q=Date.now(),E((q-ae)/1e3),ae=q)}function f(e){switch(e.which){case 13:y()}}function g(){X.drawImage(H,0,0);var e=!0,t=!1,n=void 0;try{for(var a,i=ee[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){x(a.value)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}var r=!0,l=!1,s=void 0;try{for(var d,c=te[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){A(d.value)}}catch(e){l=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw s}}p("x"+ne.items.now.key,J-4*V,oe),p("x"+ne.items.now.sword,J-V,oe),o()}function A(e){var t=W[e.type].sprites[e.frame];X.drawImage(se,t.x,t.y,V,V,Math.round(e.x),Math.round(e.y),V,V)}function x(e){var t=W[e.type].sprites,n=t[e.initialState?0:t.length-1];X.drawImage(se,n.x,n.y,V,V,Math.round(e.x),Math.round(e.y),V,V)}function p(e,t,n){for(var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X,a=0;a<e.length;a++)o.drawImage(Z,K.indexOf(e[a])*Q,0,Q,Q,t+a*Q,n,Q,Q)}function b(){requestAnimationFrame(function(){X.fillStyle=z,X.fillRect(0,0,N.width,N.height),p(document.title.toLowerCase(),0,0),p("you are cursed. locked",0,2*Q),p("in an ever repeating",0,3*Q),p("room. unravel its",0,4*Q),p("mysteries to lift the",0,5*Q),p("curse and break free.",0,6*Q),p("press enter to start,",0,9*Q),p("arrows or wasd to move",0,10*Q),p("by jerome lecomte",0,13*Q),p("for cga-jam 2017",0,14*Q),o()})}function k(){ne.y=O.y,ne.items.now.key=ne.items.max.key,ne.items.now.sword=ne.items.max.sword;var e=!0,t=!1,n=void 0;try{for(var o,a=ee[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;"chest"!==i.type&&"crate"!==i.type||(i.initialState=!0,i.collide=!0)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}function S(){var e=Math.min(innerWidth/J,innerHeight/Y);P.width=J*e,P.height=Y*e,B.mozImageSmoothingEnabled=X.mozImageSmoothingEnabled=j.mozImageSmoothingEnabled=!1,B.mozImageSmoothingEnabled=X.msImageSmoothingEnabled=j.msImageSmoothingEnabled=!1,B.mozImageSmoothingEnabled=X.imageSmoothingEnabled=j.imageSmoothingEnabled=!1}function L(e,t){var n=e.speed*t;e.x+=n*(e.moveLeft+e.moveRight),e.y+=n*(e.moveUp+e.moveDown)}function M(e){le=e,le?(ae=Date.now(),w()):cancelAnimationFrame(ie)}function E(e){var t=n();t&&(t.leftX<=0?(ne.moveLeft=t.leftX,ne.moveRight=0):(ne.moveLeft=0,ne.moveRight=t.leftX),t.leftY<=0?(ne.moveUp=t.leftY,ne.moveDown=0):(ne.moveUp=0,ne.moveDown=t.leftY)),L(ne,e);var o=!0,a=!1,r=void 0;try{for(var l,d=ee[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){(function(){var e=l.value;e===ne?"continue":e===O?(ne.y+ne.bounds.y<O.y&&(ne.y=O.y-ne.bounds.y),"continue"):e===re?(ne.y+ne.bounds.h>re.y+V&&k(),"continue"):e===$?(ne.x+ne.bounds.w>$.x+V&&s(),"continue"):void(e.collide&&ne.x+ne.bounds.x<e.x+V&&ne.x+ne.bounds.w>e.x&&ne.y+ne.bounds.y<e.y+V&&ne.y+ne.bounds.h>e.y&&(ne.moveRight&&(ne.x-=ne.x+ne.bounds.w-e.x),ne.moveLeft&&(ne.x+=e.x+V-ne.x-ne.bounds.x),ne.moveDown&&(ne.y-=ne.y+ne.bounds.h-e.y),ne.moveUp&&(ne.y+=e.y+V-ne.y-ne.bounds.y),"chest"===e.type&&e.initialState&&ne.items.now.key?(e.initialState=!e.initialState,ne.items.now.key--,te.push(i(e.type,e.x,e.y,function(){e.item&&(ne.items.now[e.item]++,ne.items.max[e.item]++,te.push(i(e.item,e.x,e.y-V)),e.item=void 0)}))):"crate"===e.type&&e.initialState&&ne.items.now.sword&&(e.initialState=!e.initialState,e.collide=!1,ne.items.now.sword--)))})()}}catch(e){a=!0,r=e}finally{try{!o&&d.return&&d.return()}finally{if(a)throw r}}var c=!0,m=!1,v=void 0;try{for(var y,u=te.entries()[Symbol.iterator]();!(c=(y=u.next()).done);c=!0){var h=_slicedToArray(y.value,2),w=h[0],f=h[1];f.nextFrame+=e,f.nextFrame>T&&(f.nextFrame-=T,++f.frame>=W[f.type].sprites.length&&(te.splice(w,1),f.callback&&f.callback()))}}catch(e){m=!0,v=e}finally{try{!c&&u.return&&u.return()}finally{if(m)throw v}}}var I=0,F=1,R=0,C=1,D=2,U=3,_=void 0;navigator.getGamepads||(n=function(){}),document.title="Deja Vu";var z="#000",Y=160,J=176,V=16,Q=8,T=.1,W={block:{sprites:[{x:48,y:16}]},chest:{sprites:[{x:80,y:0},{x:0,y:64},{x:16,y:64},{x:96,y:0}]},crate:{sprites:[{x:48,y:0},{x:64,y:0}]},door_east:{sprites:[{x:32,y:16}]},door_north:{sprites:[{x:0,y:16}]},door_south:{sprites:[{x:16,y:16}]},hero:{speed:30,bounds:{x:2,y:1,w:13,h:15},sprites:[{x:0,y:0}]},key:{sprites:[{x:16,y:0},{x:0,y:32},{x:16,y:32},{x:32,y:32},{x:48,y:32},{x:64,y:32},{x:80,y:32},{x:96,y:32},{x:16,y:0}]},sword:{sprites:[{x:32,y:0},{x:0,y:48},{x:16,y:48},{x:32,y:48},{x:48,y:48},{x:64,y:48},{x:80,y:48},{x:96,y:48},{x:32,y:0}]},tile:{sprites:[{x:64,y:16}]},wall_h:{sprites:[{x:80,y:16}]},wall_v:{sprites:[{x:96,y:16}]}},G=[["wall_h","wall_h","door_north","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"],["wall_v","block","tile","block","chest.sword","tile","crate","tile","tile","chest.sword","wall_v"],["wall_v","tile","tile","block","block","tile","tile","block","tile","tile","wall_v"],["wall_v","tile","tile","tile","crate","tile","crate","chest.key","block","crate","wall_v"],["wall_v","chest.sword","tile","tile","block","block","tile","tile","crate","crate","door_east"],["wall_v","tile","tile","block","block","block","crate","tile","block","crate","wall_v"],["wall_v","tile","tile","tile","crate","tile","tile","crate","tile","tile","wall_v"],["wall_v","block","tile","tile","tile","block","block","chest.key","block","chest.sword","wall_v"],["wall_h","wall_h","door_south","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h","wall_h"]],K="abcdefghijklmnopqrstuvwxyz0123456789.:!-%",P=document.querySelector("canvas"),j=P.getContext("2d"),N=document.createElement("canvas"),X=N.getContext("2d"),H=document.createElement("canvas"),B=H.getContext("2d"),Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUgAAAAICAYAAACbO2brAAAB5klEQVR42uVa2YrDMAw07Fvf9v8/tqWwhTZY18zI9tJAWlLHiqJjPHI1fm8/d/Qcf4c3js6t6JAdUz0T1eeqR1WX2RxLTsY3nh7s/BPP7DspZGbsw+iS0bUSi6gt0Pcf4oOR7+bX88M6Xjd1jL87cNXzo2vF8yP5M4DMzp9dWzaM7HsNCPX8Dv/svq7YSGXfyng2NqJ7Mr5Vvb8SIBHZr3mWPUc1gLsB5P33bwRIhf3+6/gOgNs1v0IQojzxYgPJrysDVfqPAUmPHXoAmWHY5kLR4WDPAYoEt+RbhsisgDM5MwMrAJQByJMZWHeCIfMzMVqNj4h9VfMnC4CI/hkZWYC24r9iX5bpWfMigIwYrJmnqxlEJ4NEACwCSFS+l0AewF+/T2VAEYBUFjJFfFl2VJSAlg8rDBBlcSiAov7PgoiVH0j8ZBgiM474F2IwihK1k0Eie3irtxgY+yifn9njUpSI0QrP7nGx9mf1W72FU8kDRfwp7OPlsYIhsiW2t+iPXQ5mAvyEAGZLLBQgmT9pvH/Su/bY0BKoAyAt+50M4Ih9WYas8F9Fv26ArJbuHxUI0+aws82nugnLtHFU2xtWtqlU2zSybRJM6wjS5sG0kTD+725z6Y6FqI1I1YbTPd5ZYmfbg2ZyHuewlwnHUW0vAAAAAElFTkSuQmCC",q=void 0,O=void 0,$=void 0,ee=void 0,te=void 0,ne=void 0,oe=void 0,ae=void 0,ie=void 0,re=void 0,le=void 0,se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAABQCAYAAADBTPF9AAAEzUlEQVR42u2djY7kIAiA+5K+/6NwueQ251KQX3/aYjLJzsxSLZ8g4liv6+GlAcDOFwjfzf6e0wsQr+0FUPkB6NX+30tG5aMARvU3xfe0npjG7ob3SzHtDIBRANkAxQafAK91AP9ZovuVIT/LRWrc9w0eSR10ECkXNwNeYyyw74D959zf2IIoQFgXI3mvhXk7D7ZAGlzXTbrKhorGSp4FTwPQAkC0ttMBkuAQRAogVu6vxg9KFJ4EECuPAmYBKMmfARD+R1fU+xHAXrmSb8cgeqhaeFoX2n/3ZoD3YazdLGboPqMAb8AU7pgCyMHTAmygGxN/3kdfmQCpWGQIjwzxge59eFy6XafRk+PRWCpZBP5MAmgJarIABuHfdHjrFegzGmIbWxkFkuw5CtAaF8pZpASMkh8BHEHGwY/FsgzyNLzeEiwQkQKG/zMKhLRRLAdAM6UYAcR/W8ZA7jPcQbgx0iJ/M4Bex4D8tORKo9MFTtnaaNWau5Qm4hp5TtncWKcFqJUnc6BCL5ybaSHcrtYCT0mljeaRGoAW+WOS2RpYTwGofUnTDI3801eTrmgYniG/NQqVsiUwTszA1+WzFhUbKCySivJD2fAWzKYnyruVn1A/l/igK6U/G14XXg7QCrEB36ut9VvuZwTL+xkLkHM32gZH5T0W0DxurwDOBwhaF6aFfhrAwLj4GIBwKMC0X0Y5x8WjAFoix2MAWoMWJgx+hQs1h/+HAAx9XwBfCtA7D/S4sCz5p7rQWRbongdqlDdqYFT+i0FMTSNOCGKSMzEhgKofpkouIijvmsgrMvifmAc+MpVmWIY5LROTPg98XDLbsZb2ilTa7gXJp8tvD2KqVKlSpUqVKvRGk4zt0LvbE9m3GJVbrjtIiHIA5F9or2pPZN8iJMhZ2xyKNLV5zZkK0+RPVbtxmE02lutQ8z3NvXgBsnVq9Q+DVQJtg7J6/G2eJiheu5XNep1+L/4qgLhOtS4L4EsANqPrmeVCpC1r0uYYyg01JUAsu/z+vS6c+uddALV1U/lQ6n4s16FklwQxTJ2WLXfkRhNrVOmJQtm9g8J1LHsSNdeJ3kdks05ED1WqVKlSpUqVKu8pVG7Jkg911dV8dUWjNOs9Zt+/VjeuZLAnE2GeRjgeM9IrKyMJn/6Qvpb71MZ4ctuQSvOA8KThwJl0ngUxG6C7TRHr8wD0WmFk5WCG8jMBQurS0kKAGfVG1+NC66GweT3UY30ZAKNj4SyI2iApaz003JmyVpVXuyEJogeCpTOkLadlrMzDAQCjbhgr3xtJW905BKLw/sn8+hWILNNNHMRHrsw6lrqmJsQa4wrv1T83VV0vEAufJ0VhlicYjjyJF0J0XdML0XSNSKNnRmEZ47FnHPO4z+j9c79KMEE8YS6V0aE465Xa1ddlfYJwRhCD67K70eafAmTmAqPtwT/Dc1lT2xSFNufUAfe+rQCbfR5muaZVxhOBZv2spMpbS2iP+wHfF0AI7GBNADDj/LxPlRYAsOJ8vAK4wAJ3ypcFbrag7KNnCuAGgFfy4U8FcKEFFcCJQcwKAAUwAeC1+eCMArjZAk86P++TM4lr7/l3aefnVRCz4fy7zPPzCuCG8++yz88rgIvPv5t1fl7NAx/yuMcCWFHoo8sfuQmaToXnHdAAAAAASUVORK5CYII=";addEventListener("load",d)}();
//# sourceMappingURL=game.js.map</script></body></html>